#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$ROOT_DIR"

if ! command -v uv >/dev/null 2>&1; then
  echo "ERROR: uv is not installed or not on PATH." >&2
  echo "Install from: https://docs.astral.sh/uv/getting-started/installation/" >&2
  exit 1
fi

# Ensure project venv exists and all dependencies are synced.
uv sync --extra dev

VENV_PATH="$ROOT_DIR/.venv"
if [[ ! -x "$VENV_PATH/bin/python" ]]; then
  echo "ERROR: Expected uv environment at $VENV_PATH but it was not created." >&2
  exit 1
fi

export VIRTUAL_ENV="$VENV_PATH"
export PATH="$VIRTUAL_ENV/bin:$PATH"
unset PYTHONHOME || true

echo "Activated uv environment: $VIRTUAL_ENV"
echo "Type 'exit' to leave this shell."
exec "${SHELL:-/bin/bash}" -i
